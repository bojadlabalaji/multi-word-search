let d=[];chrome.runtime.onMessage.addListener((e,n,o)=>{e.action==="highlight"&&(p(),e.searches.forEach(c=>u(c.term,c.color)))});function p(){d.forEach(e=>{const n=e.parentNode;n&&(n.replaceChild(document.createTextNode(e.textContent),e),n.normalize())}),d=[]}function u(e,n){if(!e)return;const o=new RegExp(f(e),"gi"),c=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:function(t){return t.parentNode.nodeName!=="SCRIPT"&&t.parentNode.nodeName!=="STYLE"&&t.parentNode.nodeName!=="NOSCRIPT"&&!t.parentNode.classList.contains("multi-search-highlight")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),i=[];for(;c.nextNode();)i.push(c.currentNode);i.forEach(t=>{if(!t.textContent.match(o))return;const a=document.createDocumentFragment();let s=0,l;for(;(l=o.exec(t.textContent))!==null;){const m=t.textContent.slice(s,l.index);m&&a.appendChild(document.createTextNode(m));const r=document.createElement("mark");r.className="multi-search-highlight",r.style.backgroundColor=n,r.style.color=g(n),r.textContent=l[0],a.appendChild(r),d.push(r),s=o.lastIndex}const h=t.textContent.slice(s);h&&a.appendChild(document.createTextNode(h)),t.parentNode.replaceChild(a,t)})}function f(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function g(e){const n=parseInt(e.slice(1,3),16),o=parseInt(e.slice(3,5),16),c=parseInt(e.slice(5,7),16);return(n*299+o*587+c*114)/1e3>=128?"#000000":"#ffffff"}
